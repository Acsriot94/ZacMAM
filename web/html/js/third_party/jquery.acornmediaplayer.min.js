(function(a){a.fn.acornMediaPlayer=function(b){var g={theme:"access",nativeSliders:false,volumeSlider:"horizontal",captionsOn:false,tooltipsOn:false};b=a.extend(g,b);var h=function(){var i=new Date();return i.getTime()};function f(){try{return"localStorage" in window&&window.localStorage!==null}catch(i){return false}}var e="ontouchstart" in document.documentElement;var d=(f)?localStorage.getItem("acornvolume"):1;if(!d){d=1}var c=function(){var ab={$self:a(this)};var P;var af;var k;var L;var N={play:"Play",playTitle:"Start playback",pause:"Pause",pauseTitle:"Pause playback",mute:"Mute",unmute:"Unmute",fullscreen:"Fullscreen",fullscreenTitle:"Toggle fullscreen mode",volumeTitle:"Volume control",seekTitle:"",captions:"Captions",captionsTitle:"Show captions",captionsChoose:"Choose caption",transcript:"Transcript",transcriptTitle:"Show transcript",syncTitle:"Sync",skipBackTitle:"Back 5 seconds",infoTitle:"Info"};var A=a('<div class="acorn-player" role="application"></div>').addClass(b.theme);ab.$self.attr("tabindex","0");ab.id=ab.$self.attr("id");if(!ab.id){ab.id="acorn"+h();ab.$self.attr("id",ab.id)}var Q=(ab.$self.is("video"))?'<button class="acorn-fullscreen-button" aria-controls="'+ab.id+'"></button>':"";var u="";if(!navigator.userAgent.match(/(iPad|iPhone|iPod|iOS)/g)){u='<div class="acorn-volume-box"><button class="acorn-volume-button" aria-controls="'+ab.id+'"></button><input type="range" class="acorn-volume-slider" value="1" min="0" max="1" step="0.05" aria-controls="'+ab.id+'"/></div>'}var t=(b.tooltipsOn)?'<div class="acorn-tooltip"><div>':"";var n='<div class="marker-bar"></div><div class="acorn-controls"><button class="acorn-play-button" aria-controls="'+ab.id+'"></button><input type="range" class="acorn-seek-slider" value="0" min="0" max="150" step="0.1" aria-controls="'+ab.id+'"/><button class="acorn-skip-back-button" title="Back 5 seconds" aria-controls="'+ab.id+'"></button>'+u+Q+'<button class="acorn-sync-button" title="Playback Sync" aria-controls="'+ab.id+'"></button><button class="acorn-info-button" title="Info" aria-controls="'+ab.id+'"></button><div style="width:100%;text-align:center" id="timecode_box">Loading...</div></div>'+t;var V='<div class="acorn-caption"></div>';var ac='<div class="acorn-transcript" role="region" aria-live="assertive"></div>';ab.$self.after(A);A[0].appendChild(ab.$self[0].cloneNode(true));ab.$self.remove();ab.$self=A.find("video, audio");ab.$self.after(n).after('<div class="loading-media"></div>');ab.$container=ab.$self.parent(".acorn-player");ab.$controls=a(".acorn-controls",ab.$container);ab.$markerBar=a(".marker-bar",ab.$container);ab.$playBtn=a(".acorn-play-button",ab.$container);ab.$skipBackBtn=a(".acorn-skip-back-button",ab.$container);ab.$seek=a(".acorn-seek-slider",ab.$container);ab.$timer=a(".acorn-timer",ab.$container);ab.$volume=a(".acorn-volume-slider",ab.$container);ab.$volumeBtn=a(".acorn-volume-button",ab.$container);ab.$fullscreenBtn=a(".acorn-fullscreen-button",ab.$container);ab.$syncBtn=a(".acorn-sync-button",ab.$container);ab.$infoBtn=a(".acorn-info-button",ab.$container);ab.$tooltip=a(".acorn-tooltip",ab.$container);ab.$controls.after(V);ab.$container.after(ac);ab.$transcript=ab.$container.next(".acorn-transcript");ab.$transcriptBtn=a(".acorn-transcript-button",ab.$container);ab.$caption=a(".acorn-caption",ab.$container);ab.$captionBtn=a(".acorn-caption-button",ab.$container);ab.$captionSelector=a(".acorn-caption-selector",ab.$container);ab.$self.attr("data-width",ab.$self.width());ab.$self.attr("data-height",ab.$self.height());var X=function(aj){var ah=Math.floor(aj/60)<10?"0"+Math.floor(aj/60):Math.floor(aj/60);var ai=Math.floor(aj-(ah*60))<10?"0"+Math.floor(aj-(ah*60)):Math.floor(aj-(ah*60));return ah+":"+ai};var I=function(){if(!ab.$self.prop("paused")){ab.$self.trigger("pause")}else{ab.$self[0].playbackRate=1;ab.$self[0].play()}};var U=function(){ab.$playBtn.addClass("acorn-paused-button")};var K=function(){ab.$playBtn.removeClass("acorn-paused-button")};var w=function(){var ah=ab.$self.prop("currentTime");ab.$timer.text(X(ah));if(!P){if(b.nativeSliders){ab.$seek.attr("value",ah)}else{ab.$seek.slider("value",ah)}}if(L){p()}updateTimecode(true,(ab.$self.prop("paused")))};var T=function(al){var ai=Math.floor(al/60)<10?""+Math.floor(al/60):Math.floor(al/60);var ak=Math.floor(al-(ai*60))<10?""+Math.floor(al-(ai*60)):Math.floor(al-(ai*60));var ah;var am="minutes";var aj="seconds";if(ai==1){am="minute"}if(ak==1){aj="second"}if(ai===0){ah=ak+" "+aj}else{ah=ai+" "+am+" "+ak+" "+aj}return ah};var W=function(){ab.$captionBtn.trigger("blur")};var Y=function(ai,ah){if(!window.isSessionOwner){if(b.nativeSliders){ab.$seek.val=ab.$self[0].currentTime}else{ah.value=ab.$self[0].currentTime}return}if(!ab.$self.get(0).paused){af=true}ab.$self.trigger("pause");P=true;var aj;if(b.nativeSliders){aj=ab.$seek.val()}else{aj=ah.value}if(ab.$self[0].readyState>=3){ab.$self[0].currentTime=aj;console.log("seek loc: "+aj)}W()};var ad=function(aj,ah){if(!window.isSessionOwner){if(b.nativeSliders){ab.$seek.val=ab.$self[0].currentTime}else{ah.value=ab.$self[0].currentTime}return}var ak;if(b.nativeSliders){ak=ab.$seek.val()}else{ak=ah.value}console.log("seek loc: "+ak);if(ak!=ab.$self[0].currentTime){ab.$self[0].currentTime=ak}if(af){ab.$self.trigger("play");af=false}P=false;var ai=a(ah.handle);ai.attr("aria-valuenow",parseInt(ah.value,10));ai.attr("aria-valuetext",T(ah.value))};var y=function(aj,ai){var ah={role:"slider","aria-valuenow":parseInt(ai.value,10),"aria-valuemin":parseInt(ai.min,10),"aria-valuemax":parseInt(ai.max,10),"aria-valuetext":ai.valuetext,tabindex:"0"};aj.attr(ah)};var B=function(){var ah=ab.$seek.attr("class");var ak='<div class="'+ah+'" title="'+N.seekTitle+'"></div>';ab.$seek.after(ak).remove();ab.$seek=a("."+ah,ab.$container);var ai='<div class="ui-slider-range acorn-buffer"></div>';ab.$seek.append(ai);ab.$buffer=a(".acorn-buffer",ab.$container);var aj={value:0,step:0.03,orientation:"horizontal",range:"min",min:0,max:100};ab.$seek.slider(aj);ab.$seek.hover(C,O);ab.$seek.mousemove(C)};var C=function(ai){a(".tc_hover").show();var aj=ab.$seek.offset();var ah=a("#player_container").offset();a(".tc_hover").css("top",aj.top-ah.top-30);a(".tc_hover").css("left",ai.pageX-aj.left-(a(".tc_hover").width()/2));a(".tc_hover").html(timecodeForPercentPosition((ai.pageX-aj.left)/ab.$seek.width()))};var O=function(){a(".tc_hover").hide()};var S=function(){var ah=ab.$self[0].duration;if(b.nativeSliders){ab.$seek.attr("max",ah);ab.$seek.bind("change",Y);if(window.isSessionOwner){ab.$seek.bind("mousedown",Y);ab.$seek.bind("mouseup",ad)}}else{var ai={value:0,step:0.03,orientation:"horizontal",range:"min",min:0,max:ah,slide:Y,stop:ad};ab.$seek.slider("option",ai);ai.valuetext=T(ai.value);y(ab.$seek.find(".ui-slider-handle"),ai);a(".ui-slider-handle",ab.$seek).click(W);ab.$self.bind("progress",o)}ab.$self.next(".loading-media").remove()};var o=function(al){var ah=parseInt(ab.$self.prop("duration"),10);var ak=this.buffered;if(ak&&ak.length){var ai=parseInt(this.buffered.end(0)-this.buffered.start(0),10);var aj=(ai*100)/ah;ab.$buffer.css("width",aj+"%")}};var z=function(ai,ah){d=ah.value;localStorage.setItem("acornvolume",d);if(ab.$self.prop("muted")){ab.$self.prop("muted",false);ab.$volumeBtn.removeClass("acorn-volume-mute")}ab.$self.prop("volume",d);ab.$volume.$handle.attr("aria-valuenow",Math.round(d*100));ab.$volume.$handle.attr("aria-valuetext",Math.round(d*100)+" percent");W()};var ae=function(){if(ab.$self.prop("muted")===true){ab.$self.prop("muted",false);if(b.nativeSliders){ab.$volume.val(d)}else{ab.$volume.slider("value",d)}ab.$volumeBtn.removeClass("acorn-volume-mute")}else{ab.$self.prop("muted",true);if(b.nativeSliders){ab.$volume.val("0")}else{ab.$volume.slider("value","0")}ab.$volumeBtn.addClass("acorn-volume-mute")}};var G=function(){if(b.nativeSliders){ab.$volume.bind("change",function(){ab.$self.prop("muted",false);d=ab.$volume.val();ab.$self.prop("volume",d)})}else{var ai=ab.$volume.attr("class");var ah='<div class="'+ai+'" title="'+N.volumeTitle+'"></div>';ab.$volume.after(ah).remove();ab.$volume=a("."+ai,ab.$container);var aj={value:d,orientation:b.volumeSlider,range:"min",max:1,min:0,step:0.1,animate:true,slide:z};ab.$volume.slider(aj);ab.$volume.$handle=ab.$volume.find(".ui-slider-handle");aj.max=100;aj.value=aj.value*100;aj.valuetext=aj.value+" percent";y(ab.$volume.$handle,aj);a(".ui-slider-handle",ab.$volume).click(W)}ab.$volumeBtn.click(ae)};var x=function(){rewind()};var Z=function(){fastForward()};var v=function(){skipBack()};var D=function(){ab.$self.attr({width:a(window).width(),height:a(window).height()})};var F=function(){var ak=ab.$self[0].parentNode.parentNode;if(k){if(document.exitFullscreen){document.exitFullscreen()}else{if(document.webkitExitFullScreen){document.webkitExitFullScreen()}else{if(document.webkitExitFullscreen){document.webkitExitFullscreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.msExitFullscreen){document.msExitFullscreen()}else{a("body").css("overflow","auto");var ah=ab.$self.attr("data-width");var ai=ab.$self.attr("data-height");ab.$self.removeClass("fullscreen-video").attr({width:ah,height:ai});a(window).unbind("resize");ab.$controls.removeClass("fullscreen-controls")}}}}}k=false;q()}else{if(ak.supportsFullscreen){ak.requestFullscreen()}else{if(ak.webkitRequestFullScreen){ak.webkitRequestFullScreen()}else{if(ak.webkitEnterFullScreen){ak.webkitEnterFullScreen()}else{if(ak.webkitRequestFullscreen){ak.webkitRequestFullscreen()}else{if(ak.webkitEnterFullscreen){ak.webkitEnterFullscreen()}else{if(ak.mozRequestFullScreen){ak.mozRequestFullScreen()}else{if(ak.msRequestFullscreen){ak.msRequestFullscreen()}else{a("body").css("overflow","hidden");ab.$self.addClass("fullscreen-video").attr({width:a(window).width(),height:a(window).height()});a(window).resize(D);ab.$controls.addClass("fullscreen-controls")}}}}}}}ak.style.maxWidth="100%";ak.style.maxHeight="100%";ak.style.width="100%";ak.style.position="relative";ab.$self[0].style.height="100%";ab.$self[0].style.maxWidth="100%";ab.$self[0].style.maxHeight="100%";ab.$self[0].parentNode.style.maxWidth="100%";ab.$self[0].parentNode.style.maxHeight="100%";console.log("video height: "+ak.offsetHeight);console.log("page height: "+document.body.offsetHeight);var aj=document.body.offsetHeight-ak.offsetHeight-a(".acorn-controls").height();console.log("diff: "+aj);if(aj>20){ak.style.paddingTop=aj}if(!isIphone){a(".acorn-player.access").append(a("#comment-container").hide())}k=true;ak.focus()}};var m=function(ah){console.log("full screen change");if(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement){k=false;q();console.log("full screen false")}else{k=true;annotationMode=false;resizeAnnotation();resetFullScreenHideTimer()}};function q(){console.log("restored");var ah=ab.$self[0].parentNode.parentNode;ah.style.maxWidth="960px";ah.style.maxHeight="";ah.style.minHeight="300px";ah.style.width="65%";ah.style.height="";ah.style.paddingTop=0;ab.$self[0].parentNode.style.maxWidth="960px";ab.$self[0].parentNode.style.maxHeight="";ab.$self[0].parentNode.style.minHeight="300px";ab.$self[0].style.width="100%";ab.$self[0].style.height=ab.$self.attr("data-defaultHeight")+"px";ab.$self[0].style.minHeight="300px";a("video").css("height","");recenterElements();cancelFullscreenHideTimer();a(".acorn-controls").show();a(".marker-bar").show();resizeAnnotation();if(!isIphone){a("#player-rightbar").append(a(".acorn-player.access #comment-container").show())}}var ag=function(ah){if(a(this).attr("title")){ab.$tooltip.html(a(this).attr("title")).addClass("show-tooltip")}};var E=function(ah){if(a(this).attr("title")){ab.$tooltip.removeClass("show-tooltip")}};var R="acorn-caption-active";var J="acorn-caption-loading";var i="acorn-transcript-active";var l="acornCaptions"+h();var H=function(){return;captions="";ab.$caption.hide();activeCaptions=false;ab.$transcriptBtn.removeClass(i).hide();ab.$transcript.hide();ab.$captionBtn.removeClass(R)};var p=function(){return;var ah=ab.$self[0].currentTime;var aj="";for(var ai=0;ai<captions.length;ai++){if(ah>=captions[ai].start&&ah<=captions[ai].end){aj=captions[ai].content;break}}ab.$caption.html(aj)};var s=function(){return;var aj=function(){var ao=ab.$captionBtn.offset();var am=ao.top-ab.$captionSelector.outerHeight(true);var al=ao.left-((ab.$captionSelector.outerWidth(true)-ab.$captionBtn.outerWidth(true))/2);var an=ab.$controls.offset();al=al-an.left;am=am-an.top;ab.$captionSelector.css({top:am,left:al})};ab.$fullscreenBtn.click(aj);a(window).resize(function(){aj()});aj();var ak;var ai=function(){if(ak){clearTimeout(ak)}ab.$captionSelector.show()};var ah=function(){ak=setTimeout(function(){ab.$captionSelector.hide()},200)};ab.$captionBtn.click(function(){a(this).focus()});ab.$captionBtn.bind("focus",ai);ab.$captionBtn.bind("blur",ah);a("input[name="+l+"]",ab.$container).bind("focus",ai);a("input[name="+l+"]",ab.$container).bind("blur",ah);ab.$captionSelector.attr("tabindex","-1");ab.$captionSelector.bind("focus",ai);ab.$captionSelector.bind("blur",ah)};var j=function(ah){return;ab.$captionBtn.addClass(J);a.ajax({url:ah,success:function(aj){captions=parseSrt(aj);ab.$transcriptBtn.show();var ai="";a(captions).each(function(){ai+='<span data-begin="'+parseInt(this.start,10)+'" data-end='+parseInt(this.end,10)+">"+this.content.replace("'","")+"</span>"});ab.$transcript.html(ai);ab.$caption.show();L=true;if(ab.$self.prop("paused")){p();updateTimecode(true,true)}ab.$captionBtn.addClass(R).removeClass(J)},error:function(){H();if(console){console.log("Error loading captions")}}})};var M=function(){return;if(a(this).hasClass(i)){ab.$transcript.hide()}else{ab.$transcript.show()}a(this).toggleClass(i)};var r=function(){return;ab.$track=a("track",ab.$self);if(ab.$track.length){ab.$captionBtn.show()}if(ab.$track.length>1){ab.$captionBtn.attr("title",N.captionsChoose);var ak='<ul><li><label><input type="radio" name="'+l+'" checked="true" />None</label></li>';ab.$track.each(function(){var al=a(this).attr("src");ak+='<li><label><input type="radio" name="'+l+'" data-url="'+a(this).attr("src")+'" />'+a(this).attr("label")+"</label></li>"});ak+="</ul>";ab.$captionSelector.html(ak);var ah=function(){var al=a(this).attr("data-url");if(al){j(al)}else{H()}};a("input[name="+l+"]",ab.$container).change(ah);s();var aj=ab.$track.first().attr("src");if(b.captionsOn){j(aj);a("input[name="+l+"]",ab.$container).removeAttr("checked");a("input[name="+l+"]:eq(1)",ab.$container).attr("checked","true")}}else{if(ab.$track.length){var ai=ab.$track.attr("src");ab.$captionBtn.bind("click",function(){if(a(this).hasClass(R)){H()}else{j(ai)}a(this).toggleClass(R)});if(b.captionsOn){j(ai)}}}ab.$transcriptBtn.bind("click",M)};var aa=function(){ab.$playBtn.bind((e)?"touchstart":"click",I);if(!window.hasSession||window.isSessionOwner){ab.$self.bind((e)?"touchstart":"click",I)}ab.$self.bind("play",U);ab.$self.bind("pause",K);ab.$self.bind("ended",K);ab.$self.bind("timeupdate",w);ab.$skipBackBtn.click(v);ab.$fullscreenBtn.click(F);a(document).on("webkitfullscreenchange mozfullscreenchange MSFullscreenChange fullscreenchange",m);ab.$syncBtn.click(toggleSync);ab.$infoBtn.click(showInfo);if(b.tooltipsOn){ab.$controls.find("button").mouseover(ag).mouseout(E)}G();ab.$self.prop("volume",d);ab.$volume.$handle.attr("aria-valuenow",Math.round(d*100));ab.$volume.$handle.attr("aria-valuetext",Math.round(d*100)+" percent");A.addClass("");if(!b.nativeSliders){B()}ab.$self.bind("loadedmetadata",function(){var ah=window.setInterval(function(){if(ab.$self[0].readyState>0){S();clearInterval(ah)}},500);r()});S();ab.$self.removeAttr("controls");if(ab.$self.is("audio")){ab.$container.addClass("audio-player")}}()};return this.each(c)}})(jQuery);function parseSrt(f){var c=f.replace(/\r+/g,"");c=c.replace(/^\s+|\s+$/g,"");c=c.replace(/<[a-zA-Z\/][^>]*>/g,"");var h=[];var e=c.split("\n\n");for(var g=0;g<e.length;g=g+1){var k="";var j,a,d,l;k=e[g];l=k.split(/\n/);if(l[0].match(/^\d+$/)&&l[1].match(/\d+:\d+:\d+/)){var b=l[1].match(/(\d+):(\d+):(\d+)(?:,(\d+))?\s*--?>\s*(\d+):(\d+):(\d+)(?:,(\d+))?/);if(b){a=(parseInt(b[1],10)*60*60)+(parseInt(b[2],10)*60)+(parseInt(b[3],10))+(parseInt(b[4],10)/1000);d=(parseInt(b[5],10)*60*60)+(parseInt(b[6],10)*60)+(parseInt(b[7],10))+(parseInt(b[8],10)/1000)}else{continue}j=l.slice(2).join("<br>")}else{continue}h.push({start:a,end:d,content:j})}return h};